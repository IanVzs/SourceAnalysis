# SourceAnalysis
开源项目的源码分析： 目前仅有`TinyHttpd`原项目地址: [此处](http://tinyhttpd.sourceforge.net/)

## CGI解释
早期的Web服务器，只能响应浏览器发来的HTTP静态资源的请求，并将存储在服务器中的静态资源返回给浏览器。随着Web技术的发展，逐渐出现了动态技术，但是Web服务器并不能够直接运行动态脚本，为了解决Web服务器与外部应用程序（CGI程序）之间数据互通，于是出现了CGI（Common Gateway Interface）通用网关接口。简单理解，可以认为CGI是Web服务器和运行其上的应用程序进行“交流”的一种约定。

CGI是Web服务器和一个独立的进程之间的协议，它会把HTTP请求Request的Header头设置成进程的环境变量，HTTP请求的Body正文设置成进程的标准输入，进程的标准输出设置为HTTP响应Response，包含Header头和Body正文。

CGI只是一个接口规范或协议，它的实现则与具体的编程语言相关。在2000年以前，CGI通用网关接口盛行，那个时候，Perl是编写CGI的主流语言，以至于一般的CGI程序都是Perl程序。

通过CGI接口，Web服务器就能够获取客户端传递的数据，并转交给服务器端的CGI程序处理，然后返回结果给客户端。简单来说，CGI实际上是一个接口标准。而通常所说的CGI指代其实是CGI程序，也就是实现了CGI接口标准的程序，只要编程语言具有标准输入、标准输出和环境变量，就可以用来编写CGI程序。

CGI程序通过标准输入（STDIN）和标准输出（STDOUT）进行数据的输入输出，此外CGI程序还通过环境变量来得到输入，操作系统提供了许多环境变量，它们定义了程序的执行环境，应用程序可以存取它们。Web服务器和CGI接口又另外设置了一些环境变量，用来向CGI程序传递一些重要的参数。CGI的GET方法还通过环境变量QUERY_STRING向CGI程序传递Form表单中的数据。

CGI工作概要
对于一个CGI程序，主要的工作是从环境变量和标准输入中读取数据，然后处理数据，最后向标准输出中输出数据。

环境变量
环境变量中存储的叫做Request Meta-Variables，也就是诸如QUERY_STRING、PATH_INFO之类的，这些都是由Web服务器通过环境变量传递给CGI程序的，CGI程序也是从环境变量中读取的。
标准输出
中存放的往往是用户通过PUTS或POST提交的数据，这些数据也是由Web服务器传递过来的。
为了处理动态请求，Web服务器会根据请求的内容，Fork创建一个新进程来运行外部C程序或Perl脚本等，这个进程会把处理完的数据返回给Web服务器，然后Web服务器把内容发送给用户，Fork创建出来的进程也会随之退出。如果下次用户请求为动态脚本，那么Web服务器会再次Fork创建一个新进程，如此周而复始的运行。

....更多推荐看原文: 还有图片～

```
作者：JunChow520
链接：https://www.jianshu.com/p/c4dc22699a42
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
```

有了以上知识，便可以很好理解为什么会有`*.cgi`文件和为什么会通过这种方式来实现.不过这里实现的也最为原始和低效。


## Python
我将原项目中的`python`cgi修改为了python3/2版通用的方式,顺便加了些注解。o(∩∩)o...

**注意**: 如果要正常运行记得chmod各个cgi文件， 如`sudo chmod 764 htdocs/*.cgi`
